name: Test IIAB install
# run-name: ${{ github.actor }} is testing out GitHub Actions 🚀
on: [push]
jobs:
  test-install:
    runs-on: ubuntu-latest
    defaults:
      run:
        #shell: bash
        working-directory: /opt/iiab/iiab
    steps:
      - run: echo "🎉 The job was automatically triggered by a ${{ github.event_name }} event."
      #- run: echo "🐧 This job is now running on a ${{ runner.os }} server hosted by GitHub!"
      - run: echo "🔎 The name of your branch is ${{ github.ref }} and your repository is ${{ github.repository }}."
      - name: Check out repository code
        uses: actions/checkout@v3
      #- run: echo "💡 The ${{ github.repository }} repository has been cloned to the runner."
      #- run: echo "🖥️ The workflow is now ready to test your code on the runner."
      #- name: List files in the repository
      #  run: |
      #    ls ${{ github.workspace }}
      - run: echo "🍏 This job's status is ${{ job.status }}."
      - name: GitHub Actions "runner" environment
        run: |
          # sudo apt update
          # sudo apt dist-upgrade -y
          # sudo apt autoremove -y
          whoami    # runner
          pwd       # /home/runner/work/iiab/iiab == $GITHUB_WORKSPACE == ${{ github.workspace }}
          ls    ####
          # ls $GITHUB_WORKSPACE
          # ls ${{ github.workspace }}
          ls -la /opt    # az, containerd, google, hostedtoolcache, microsoft, mssql-tools, pipx, pipx_bin, post-generation, runner, vsts
      - name: Set up /opt/iiab/iiab
        run: |
          mkdir /opt/iiab
          mv $GITHUB_WORKSPACE /opt/iiab
          # mkdir $GITHUB_WORKSPACE    # OR ALL SUBSEQUENT "run:" commands fail
      - name: Set up /etc/iiab/local_vars.yml
        run: |
          sudo mkdir /etc/iiab
          # touch /etc/iiab/local_vars.yml
          sudo cp vars/local_vars_none.yml /etc/iiab/local_vars.yml
      - name: Run scripts/ansible
        run: sudo scripts/ansible
      - name: Run ./iiab-ansible
        run: sudo ./iiab-install
      - name: cat /etc/iiab/iiab_state.yml
        run: cat /etc/iiab/iiab_state.yml
